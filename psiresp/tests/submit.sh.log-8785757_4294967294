============================= test session starts ==============================
platform linux -- Python 3.8.12, pytest-6.2.4, py-1.10.0, pluggy-0.13.1
rootdir: /dfs6/pub/lilyw7/pydev/psiresp, configfile: pyproject.toml
plugins: qcfractal-0.15.6, requests-mock-1.9.3
collected 5 items

test_job.py FFFFF                                                        [100%]

=================================== FAILURES ===================================
_______________________ TestSingleResp.test_unrestrained _______________________

self = <test_job.TestSingleResp object at 0x7f3d70e3f880>
dmso = Molecule(name=C2H6OS, charge=0) with 1 conformers
fractal_client = FractalClient(server_name='QCFractal Server', address='https://hpc3-l18-05:7777/', username='None')

    def test_unrestrained(self, dmso, fractal_client):
        options = RespOptions(stage_2=True, restrained_fit=False)
        job = Job(molecules=[dmso],
                  resp_options=options)
        job.run(client=fractal_client)
    
        esp_1 = [[-0.43877469, 0.14814998, 0.17996033, 0.18716814, 0.35743529,
                 -0.5085439, -0.46067469, 0.19091725, 0.15500465, 0.18935764]]
        esp_2 = [[-0.39199538, 0.15716631, 0.15716631, 0.15716631, 0.35743529,
                 -0.5085439, -0.43701446, 0.16953984, 0.16953984, 0.16953984]]
>       assert_allclose(job.stage_1_charges.unrestrained_charges, esp_1)
E       AssertionError: 
E       Not equal to tolerance rtol=1e-07, atol=0
E       
E       Mismatched elements: 10 / 10 (100%)
E       Max absolute difference: 1.1016262984813978
E       Max relative difference: 2.4775455410273772
E        x: array([[ 0.64831 , -0.205412, -0.141716, -0.156144,  0.251684, -0.541604,
E                0.640952, -0.156124, -0.203198, -0.136747]])
E        y: array([[-0.438775,  0.14815 ,  0.17996 ,  0.187168,  0.357435, -0.508544,
E               -0.460675,  0.190917,  0.155005,  0.189358]])

test_job.py:28: AssertionError
------------------------------ Captured log setup ------------------------------
INFO     SQLAlcehmySocket:sqlalchemy_socket.py:200 SQLAlchemy attempt to connect to postgresql+psycopg2://localhost:34341/test_psiresp.
INFO     SQLAlcehmySocket:sqlalchemy_socket.py:209 Connected SQLAlchemy to DB dialect postgresql with driver psycopg2
INFO     SQLAlcehmySocket:sqlalchemy_socket.py:217 DB versions: {'created_on': datetime.datetime(2021, 10, 25, 1, 57, 21, 427302), 'elemental_version': 'v0.22.0', 'fractal_version': 'v0.15.6', 'engine_version': 'v0.19.0'}
INFO     tornado.application:server.py:315 FractalServer:
INFO     tornado.application:server.py:316     Name:          QCFractal Snowflake Instance
INFO     tornado.application:server.py:317     Version:       v0.15.6
INFO     tornado.application:server.py:318     Address:       http://localhost:50287/
INFO     tornado.application:server.py:319     Database URI:  postgresql://localhost:34341/
INFO     tornado.application:server.py:320     Database Name: test_psiresp
INFO     tornado.application:server.py:321     Query Limit:   1000000

INFO     tornado.application:server.py:637 Waiting on queue_manager to build.
INFO     tornado.application:server.py:414 FractalServer successfully started.

INFO     tornado.application:web_handlers.py:146 GET: Information
INFO     tornado.access:web.py:2239 200 GET /information (::1) 4.21ms
INFO     tornado.application:managers.py:226 QueueManager:
INFO     tornado.application:managers.py:227     Version:         v0.15.6

INFO     tornado.application:managers.py:235     Queue Adapter:
INFO     tornado.application:managers.py:236         <ExecutorAdapter client=<ProcessPoolExecutor max_workers=1>>

INFO     tornado.application:handlers.py:383 QueueManager: New active manager FractalServer-hpc3-22-04-c2018a32-415c-427e-9fb0-47b2af17dbe9 detected.
INFO     tornado.access:web.py:2239 200 PUT /queue_manager (::1) 13.11ms
----------------------------- Captured stdout call -----------------------------
==from record==
ResultProtocols(wavefunction=<WavefunctionProtocolEnum.orbitals_and_eigenvalues: 'orbitals_and_eigenvalues'>, stdout=True, error_correction=ErrorCorrectionProtocol(default_policy=True, policies=None))
--keys--
dict_keys(['scf_eigenvalues_a', 'scf_orbitals_a', 'basis', 'restricted', 'orbitals_a', 'eigenvalues_a'])
----------------------------- Captured stderr call -----------------------------
qcwavefunction-construction:   0%|          | 0/1 [00:00<?, ?it/s]qcwavefunction-construction: 100%|██████████| 1/1 [00:00<00:00, 29.69it/s]
compute-esp:   0%|          | 0/1 [00:00<?, ?it/s]forrtl: error (78): process killed (SIGTERM)
Image              PC                Routine            Line        Source             
libgdma.so         00007F3DDC8BD10F  for__signal_handl     Unknown  Unknown
libpthread-2.17.s  00007F3E0E9BF630  Unknown               Unknown  Unknown
libpthread-2.17.s  00007F3E0E9BDF0D  sem_post              Unknown  Unknown
_multiprocessing.  00007F3DE726E751  Unknown               Unknown  Unknown
python3.8          000055ED8BBAC83D  Unknown               Unknown  Unknown
python3.8          000055ED8BC4B6A6  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBD6CA8  Unknown               Unknown  Unknown
python3.8          000055ED8BBAC440  Unknown               Unknown  Unknown
python3.8          000055ED8BC47C01  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBD6BDE  Unknown               Unknown  Unknown
python3.8          000055ED8BC4616A  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D754  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBA757D  PyObject_Call         Unknown  Unknown
python3.8          000055ED8BC47823  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC45F0F  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBD6BDE  Unknown               Unknown  Unknown
python3.8          000055ED8BC46F67  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC45F0F  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC29318  Unknown               Unknown  Unknown
python3.8          000055ED8BBA10C8  _PyObject_MakeTpC     Unknown  Unknown
python3.8          000055ED8BC4A940  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC4A9D1  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC45F0F  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC4A9D1  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC45F0F  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC2945A  Unknown               Unknown  Unknown
python3.8          000055ED8BBA10C8  _PyObject_MakeTpC     Unknown  Unknown
python3.8          000055ED8BC4AE5A  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBD6BDE  Unknown               Unknown  Unknown
python3.8          000055ED8BC46F67  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC45F0F  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBD6BDE  Unknown               Unknown  Unknown
python3.8          000055ED8BC46F67  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBD6CA8  Unknown               Unknown  Unknown
python3.8          000055ED8BBA7819  PyObject_Call         Unknown  Unknown
python3.8          000055ED8BC47823  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3CCEF  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBA757D  PyObject_Call         Unknown  Unknown
python3.8          000055ED8BC47823  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3CCEF  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC46F67  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC4A9D1  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBD6BDE  Unknown               Unknown  Unknown
python3.8          000055ED8BC4A9D1  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBCE797  _PyObject_FastCal     Unknown  Unknown
python3.8          000055ED8BC04BBB  Unknown               Unknown  Unknown
python3.8          000055ED8BBA125F  _PyObject_MakeTpC     Unknown  Unknown
python3.8          000055ED8BC4AE5A  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC45F0F  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBA757D  PyObject_Call         Unknown  Unknown
python3.8          000055ED8BC47823  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3CCEF  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC46F67  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC4A9D1  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBD6BDE  Unknown               Unknown  Unknown
python3.8          000055ED8BC4A9D1  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBCE797  _PyObject_FastCal     Unknown  Unknown
python3.8          000055ED8BC04BBB  Unknown               Unknown  Unknown
python3.8          000055ED8BBA795D  PyObject_Call         Unknown  Unknown
python3.8          000055ED8BC47823  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3CCEF  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC4616A  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBD6BDE  Unknown               Unknown  Unknown
python3.8          000055ED8BC46F67  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3CCEF  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBA757D  PyObject_Call         Unknown  Unknown
python3.8          000055ED8BC47823  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC4616A  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC46F67  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBA757D  PyObject_Call         Unknown  Unknown
python3.8          000055ED8BC47823  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3CCEF  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC46F67  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC4A9D1  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBD6BDE  Unknown               Unknown  Unknown
python3.8          000055ED8BC4A9D1  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBCE797  _PyObject_FastCal     Unknown  Unknown
python3.8          000055ED8BC04BBB  Unknown               Unknown  Unknown
python3.8          000055ED8BBA125F  _PyObject_MakeTpC     Unknown  Unknown
python3.8          000055ED8BC4AE5A  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBA757D  PyObject_Call         Unknown  Unknown
python3.8          000055ED8BC47823  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3CCEF  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC46F67  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC4A9D1  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBD6BDE  Unknown               Unknown  Unknown
python3.8          000055ED8BC4A9D1  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBCE797  _PyObject_FastCal     Unknown  Unknown
python3.8          000055ED8BC04BBB  Unknown               Unknown  Unknown
python3.8          000055ED8BBA125F  _PyObject_MakeTpC     Unknown  Unknown
python3.8          000055ED8BC4AE5A  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC4616A  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC4616A  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBA757D  PyObject_Call         Unknown  Unknown
python3.8          000055ED8BC47823  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3CCEF  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC46F67  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC4A9D1  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBD6BDE  Unknown               Unknown  Unknown
python3.8          000055ED8BC4A9D1  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBCE797  _PyObject_FastCal     Unknown  Unknown
python3.8          000055ED8BC04BBB  Unknown               Unknown  Unknown
python3.8          000055ED8BBA125F  _PyObject_MakeTpC     Unknown  Unknown
python3.8          000055ED8BC4AE5A  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC37AE7  Unknown               Unknown  Unknown
python3.8          000055ED8BC4616A  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC4616A  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3DAA3  PyEval_EvalCode       Unknown  Unknown
python3.8          000055ED8BCB1382  Unknown               Unknown  Unknown
python3.8          000055ED8BCC2202  Unknown               Unknown  Unknown
python3.8          000055ED8BCC53AB  Unknown               Unknown  Unknown
python3.8          000055ED8BCC558F  PyRun_SimpleFileE     Unknown  Unknown
python3.8          000055ED8BCC5A69  Py_RunMain            Unknown  Unknown
python3.8          000055ED8BCC5C69  Py_BytesMain          Unknown  Unknown
libc-2.17.so       00007F3E0E604555  __libc_start_main     Unknown  Unknown
python3.8          000055ED8BC67427  Unknown               Unknown  Unknown
compute-esp:   0%|          | 0/1 [00:06<?, ?it/s]
------------------------------ Captured log call -------------------------------
INFO     tornado.application:managers.py:347 QueueManager successfully started.

INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 6 tasks.
INFO     tornado.application:managers.py:697 Acquired 6 new tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 25.80ms
INFO     tornado.access:web.py:2239 200 PUT /queue_manager (::1) 15.31ms
INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 7.95ms
INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 7.89ms
INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 6.48ms
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 8.39ms
INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 6.19ms
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 6.47ms
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 6.92ms
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 6.27ms
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 6.46ms
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 7.58ms
INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 7.63ms
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 6.68ms
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 14.77ms
________________________ TestSingleResp.test_restrained ________________________

self = <test_job.TestSingleResp object at 0x7f3d709fb850>
dmso = Molecule(name=C2H6OS, charge=0) with 1 conformers
fractal_client = FractalClient(server_name='QCFractal Server', address='https://hpc3-l18-05:7777/', username='None')

    def test_restrained(self, dmso, fractal_client):
        options = RespOptions(stage_2=True, restrained_fit=True)
        job = Job(molecules=[dmso],
                  resp_options=options)
        job.run(client=fractal_client)
    
        resp_1 = [[-0.31436216, 0.11376836, 0.14389443, 0.15583112, 0.30951582,
                  -0.50568553, -0.33670393, 0.15982115, 0.12029174, 0.153629]]
        resp_2 = [[-0.25158642, 0.11778735, 0.11778735, 0.11778735, 0.30951582,
                  -0.50568553, -0.29298059, 0.12912489, 0.12912489, 0.12912489]]
>       assert_allclose(job.stage_1_charges.restrained_charges, resp_1, atol=1e-5)
E       AssertionError: 
E       Not equal to tolerance rtol=1e-07, atol=1e-05
E       
E       Mismatched elements: 10 / 10 (100%)
E       Max absolute difference: 0.9771713981658839
E       Max relative difference: 3.0606701659609223
E        x: array([[ 0.647797, -0.205243, -0.141569, -0.156023,  0.251782, -0.541555,
E                0.640467, -0.156013, -0.20304 , -0.136604]])
E        y: array([[-0.314362,  0.113768,  0.143894,  0.155831,  0.309516, -0.505686,
E               -0.336704,  0.159821,  0.120292,  0.153629]])

test_job.py:41: AssertionError
----------------------------- Captured stdout call -----------------------------
==from record==
ResultProtocols(wavefunction=<WavefunctionProtocolEnum.orbitals_and_eigenvalues: 'orbitals_and_eigenvalues'>, stdout=True, error_correction=ErrorCorrectionProtocol(default_policy=True, policies=None))
--keys--
dict_keys(['scf_eigenvalues_a', 'scf_orbitals_a', 'basis', 'restricted', 'orbitals_a', 'eigenvalues_a'])
----------------------------- Captured stderr call -----------------------------
qcwavefunction-construction:   0%|          | 0/1 [00:00<?, ?it/s]qcwavefunction-construction: 100%|██████████| 1/1 [00:00<00:00, 21.45it/s]
compute-esp:   0%|          | 0/1 [00:00<?, ?it/s]forrtl: error (78): process killed (SIGTERM)
Image              PC                Routine            Line        Source             
libgdma.so         00007F3DDC8BD10F  for__signal_handl     Unknown  Unknown
libpthread-2.17.s  00007F3E0E9BF630  Unknown               Unknown  Unknown
libpthread-2.17.s  00007F3E0E9BDF0D  sem_post              Unknown  Unknown
_multiprocessing.  00007F3DE726E751  Unknown               Unknown  Unknown
python3.8          000055ED8BBAC83D  Unknown               Unknown  Unknown
python3.8          000055ED8BC4B6A6  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBD6CA8  Unknown               Unknown  Unknown
python3.8          000055ED8BBAC440  Unknown               Unknown  Unknown
python3.8          000055ED8BC47C01  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBD6BDE  Unknown               Unknown  Unknown
python3.8          000055ED8BC4616A  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D754  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBA757D  PyObject_Call         Unknown  Unknown
python3.8          000055ED8BC47823  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC45F0F  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBD6BDE  Unknown               Unknown  Unknown
python3.8          000055ED8BC46F67  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC45F0F  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC29318  Unknown               Unknown  Unknown
python3.8          000055ED8BBA10C8  _PyObject_MakeTpC     Unknown  Unknown
python3.8          000055ED8BC4A940  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC4A9D1  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC45F0F  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC4A9D1  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC45F0F  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC2945A  Unknown               Unknown  Unknown
python3.8          000055ED8BBA10C8  _PyObject_MakeTpC     Unknown  Unknown
python3.8          000055ED8BC4AE5A  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBD6BDE  Unknown               Unknown  Unknown
python3.8          000055ED8BC46F67  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC45F0F  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBD6BDE  Unknown               Unknown  Unknown
python3.8          000055ED8BC46F67  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBD6CA8  Unknown               Unknown  Unknown
python3.8          000055ED8BBA7819  PyObject_Call         Unknown  Unknown
python3.8          000055ED8BC47823  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3CCEF  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBA757D  PyObject_Call         Unknown  Unknown
python3.8          000055ED8BC47823  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3CCEF  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC46F67  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC4A9D1  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBD6BDE  Unknown               Unknown  Unknown
python3.8          000055ED8BC4A9D1  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBCE797  _PyObject_FastCal     Unknown  Unknown
python3.8          000055ED8BC04BBB  Unknown               Unknown  Unknown
python3.8          000055ED8BBA125F  _PyObject_MakeTpC     Unknown  Unknown
python3.8          000055ED8BC4AE5A  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC45F0F  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBA757D  PyObject_Call         Unknown  Unknown
python3.8          000055ED8BC47823  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3CCEF  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC46F67  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC4A9D1  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBD6BDE  Unknown               Unknown  Unknown
python3.8          000055ED8BC4A9D1  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBCE797  _PyObject_FastCal     Unknown  Unknown
python3.8          000055ED8BC04BBB  Unknown               Unknown  Unknown
python3.8          000055ED8BBA795D  PyObject_Call         Unknown  Unknown
python3.8          000055ED8BC47823  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3CCEF  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC4616A  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBD6BDE  Unknown               Unknown  Unknown
python3.8          000055ED8BC46F67  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3CCEF  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBA757D  PyObject_Call         Unknown  Unknown
python3.8          000055ED8BC47823  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC4616A  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC46F67  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBA757D  PyObject_Call         Unknown  Unknown
python3.8          000055ED8BC47823  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3CCEF  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC46F67  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC4A9D1  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBD6BDE  Unknown               Unknown  Unknown
python3.8          000055ED8BC4A9D1  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBCE797  _PyObject_FastCal     Unknown  Unknown
python3.8          000055ED8BC04BBB  Unknown               Unknown  Unknown
python3.8          000055ED8BBA125F  _PyObject_MakeTpC     Unknown  Unknown
python3.8          000055ED8BC4AE5A  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBA757D  PyObject_Call         Unknown  Unknown
python3.8          000055ED8BC47823  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3CCEF  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC46F67  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC4A9D1  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBD6BDE  Unknown               Unknown  Unknown
python3.8          000055ED8BC4A9D1  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBCE797  _PyObject_FastCal     Unknown  Unknown
python3.8          000055ED8BC04BBB  Unknown               Unknown  Unknown
python3.8          000055ED8BBA125F  _PyObject_MakeTpC     Unknown  Unknown
python3.8          000055ED8BC4AE5A  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC4616A  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC4616A  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBA757D  PyObject_Call         Unknown  Unknown
python3.8          000055ED8BC47823  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3CCEF  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC46F67  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC4A9D1  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBD6BDE  Unknown               Unknown  Unknown
python3.8          000055ED8BC4A9D1  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3D7B4  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BBCE797  _PyObject_FastCal     Unknown  Unknown
python3.8          000055ED8BC04BBB  Unknown               Unknown  Unknown
python3.8          000055ED8BBA125F  _PyObject_MakeTpC     Unknown  Unknown
python3.8          000055ED8BC4AE5A  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC37AE7  Unknown               Unknown  Unknown
python3.8          000055ED8BC4616A  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3D3D7  _PyFunction_Vecto     Unknown  Unknown
python3.8          000055ED8BC4616A  _PyEval_EvalFrame     Unknown  Unknown
python3.8          000055ED8BC3C1F0  _PyEval_EvalCodeW     Unknown  Unknown
python3.8          000055ED8BC3DAA3  PyEval_EvalCode       Unknown  Unknown
python3.8          000055ED8BCB1382  Unknown               Unknown  Unknown
python3.8          000055ED8BCC2202  Unknown               Unknown  Unknown
python3.8          000055ED8BCC53AB  Unknown               Unknown  Unknown
python3.8          000055ED8BCC558F  PyRun_SimpleFileE     Unknown  Unknown
python3.8          000055ED8BCC5A69  Py_RunMain            Unknown  Unknown
python3.8          000055ED8BCC5C69  Py_BytesMain          Unknown  Unknown
libc-2.17.so       00007F3E0E604555  __libc_start_main     Unknown  Unknown
python3.8          000055ED8BC67427  Unknown               Unknown  Unknown
compute-esp:   0%|          | 0/1 [00:06<?, ?it/s]
------------------------------ Captured log call -------------------------------
INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 7.64ms
INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 6.49ms
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 8.21ms
INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 7.22ms
INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 7.55ms
INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 8.89ms
INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 6.75ms
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 6.63ms
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 9.78ms
INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 6.88ms
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 18.21ms
INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 6.19ms
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 6.37ms
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
_ TestMultiResp.test_charge_constraints[False-0.0-/dfs6/pub/lilyw7/pydev/psiresp/psiresp/tests/data/charges/amm_dimethyl_espA1.dat] _

self = <test_job.TestMultiResp object at 0x7f3d6ca063d0>
nme2ala2 = Molecule(name=C7H14N2O2, charge=0) with 2 conformers
methylammonium = Molecule(name=CH6N, charge=1) with 1 conformers
methylammonium_nme2ala2_charge_constraints = ChargeConstraintOptions(charge_sum_constraints=[ChargeSumConstraint(atoms={Atom(index=23, molecule=Molecule(name=C7H14...ex=6, molecule=Molecule(name=CH6N, charge=1) with 1 conformers)})], symmetric_methyls=False, symmetric_methylenes=True)
stage_2 = False, resp_a = 0.0
red_charges = [array([-0.2416,  0.1646,  0.1647,  0.1653, -0.0735,  0.2735,  0.2735,
        0.2735]), array([-0.6331,  0.1595,  0.1...215,
        0.1261,  0.1261,  0.1261,  0.6163, -0.5722, -0.3223,  0.2428,
       -0.3687,  0.1598,  0.1515,  0.1369])]
fractal_client = FractalClient(server_name='QCFractal Server', address='https://hpc3-l18-05:7777/', username='None')
job_esps = {'0c7e913c4a8462f7181fc25edf913be91be8d7c4': array([0.0352396497189797, 0.0201718178403816, 0.0161697547396198, ...,
 ....1636058459170928,
       0.1675559689370116, 0.1614454272167087, 0.1591318125841346,
       0.1597205214363893]), ...}
job_grids = {'0c7e913c4a8462f7181fc25edf913be91be8d7c4': array([[-1.3723571286992204,  4.006524139220508 ,  3.6675488955960907],
 ....2996193717060396,  1.3485806710094863],
       [ 3.987635647849548 , -1.485481850970714 ,  1.3485806710094863]]), ...}

    @pytest.mark.parametrize("stage_2, resp_a, red_charges", [
        (False, 0.0, AMM_NME_OPT_ESPA1_CHARGES),
        (False, 0.01, AMM_NME_OPT_RESPA2_CHARGES),
        (True, 0.0005, AMM_NME_OPT_RESPA1_CHARGES),
    ], indirect=['red_charges'])
    def test_charge_constraints(self, nme2ala2, methylammonium,
                                methylammonium_nme2ala2_charge_constraints,
                                stage_2, resp_a, red_charges,
                                fractal_client, job_esps, job_grids):
    
        resp_options = RespOptions(stage_2=stage_2, resp_a=resp_a)
        job = Job(molecules=[methylammonium, nme2ala2],
                  charge_constraints=methylammonium_nme2ala2_charge_constraints,
                  resp_options=resp_options)
        job.compute_orientation_energies(client=fractal_client)
        # job.compute_esps()
        for mol in job.molecules:
            for conf in mol.conformers:
                for orient in conf.orientations:
                    fname = orient.qcmol.get_hash()
                    orient.esp = job_esps[fname]
                    orient.grid = job_grids[fname]
                    # np.savetxt(f"{fname}_esp.dat", orient.esp)
                    # np.savetxt(f"{fname}_grid.dat", orient.grid)
        job.compute_charges()
        charges = np.concatenate(job.charges)
        print(job.charges)
    
        print(red_charges)
    
        assert_allclose(charges[[0, 1, 2, 3, 8, 9, 10, 11, 12, 13, 14, 15]].sum(), 0, atol=1e-7)
        assert_allclose(charges[[27, 28, 29, 30, 31, 32]].sum(), 0, atol=1e-7)
        assert_allclose(charges[25], 0.6163)
        assert_allclose(charges[26], -0.5722)
        assert_allclose(charges[18], charges[22])
        for calculated, reference in zip(job.charges[::-1], red_charges[::-1]):
>           assert_allclose(calculated, reference)
E           AssertionError: 
E           Not equal to tolerance rtol=1e-07, atol=0
E           
E           Mismatched elements: 23 / 25 (92%)
E           Max absolute difference: 0.2393053879209078
E           Max relative difference: 0.5220388673587211
E            x: array([-0.393795,  0.100151,  0.109016,  0.109143,  0.831336, -0.588703,
E                  -0.733885,  0.347753,  0.160001, -0.201461,  0.069634,  0.069634,
E                   0.069634, -0.201461,  0.069634,  0.069634,  0.069634,  0.6163  ,...
E            y: array([-0.6331,  0.1595,  0.1615,  0.1619,  1.018 , -0.6328, -0.8731,
E                   0.3851,  0.2953, -0.4215,  0.1261,  0.1261,  0.1261, -0.4215,
E                   0.1261,  0.1261,  0.1261,  0.6163, -0.5722, -0.3223,  0.2428,
E                  -0.3687,  0.1598,  0.1515,  0.1369])

test_job.py:82: AssertionError
------------------------------ Captured log setup ------------------------------
INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 7.89ms
INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 6.47ms
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 6.69ms
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 7.73ms
----------------------------- Captured stdout call -----------------------------
==from record==
ResultProtocols(wavefunction=<WavefunctionProtocolEnum.orbitals_and_eigenvalues: 'orbitals_and_eigenvalues'>, stdout=True, error_correction=ErrorCorrectionProtocol(default_policy=True, policies=None))
--keys--
dict_keys(['scf_eigenvalues_a', 'scf_orbitals_a', 'basis', 'restricted', 'orbitals_a', 'eigenvalues_a'])
==from record==
ResultProtocols(wavefunction=<WavefunctionProtocolEnum.orbitals_and_eigenvalues: 'orbitals_and_eigenvalues'>, stdout=True, error_correction=ErrorCorrectionProtocol(default_policy=True, policies=None))
--keys--
dict_keys(['scf_eigenvalues_a', 'scf_orbitals_a', 'basis', 'restricted', 'orbitals_a', 'eigenvalues_a'])
==from record==
ResultProtocols(wavefunction=<WavefunctionProtocolEnum.orbitals_and_eigenvalues: 'orbitals_and_eigenvalues'>, stdout=True, error_correction=ErrorCorrectionProtocol(default_policy=True, policies=None))
--keys--
dict_keys(['scf_eigenvalues_a', 'scf_orbitals_a', 'basis', 'restricted', 'orbitals_a', 'eigenvalues_a'])
==from record==
ResultProtocols(wavefunction=<WavefunctionProtocolEnum.orbitals_and_eigenvalues: 'orbitals_and_eigenvalues'>, stdout=True, error_correction=ErrorCorrectionProtocol(default_policy=True, policies=None))
--keys--
dict_keys(['scf_eigenvalues_a', 'scf_orbitals_a', 'basis', 'restricted', 'orbitals_a', 'eigenvalues_a'])
==from record==
ResultProtocols(wavefunction=<WavefunctionProtocolEnum.orbitals_and_eigenvalues: 'orbitals_and_eigenvalues'>, stdout=True, error_correction=ErrorCorrectionProtocol(default_policy=True, policies=None))
--keys--
dict_keys(['scf_eigenvalues_a', 'scf_orbitals_a', 'basis', 'restricted', 'orbitals_a', 'eigenvalues_a'])
==from record==
ResultProtocols(wavefunction=<WavefunctionProtocolEnum.orbitals_and_eigenvalues: 'orbitals_and_eigenvalues'>, stdout=True, error_correction=ErrorCorrectionProtocol(default_policy=True, policies=None))
--keys--
dict_keys(['scf_eigenvalues_a', 'scf_orbitals_a', 'basis', 'restricted', 'orbitals_a', 'eigenvalues_a'])
==from record==
ResultProtocols(wavefunction=<WavefunctionProtocolEnum.orbitals_and_eigenvalues: 'orbitals_and_eigenvalues'>, stdout=True, error_correction=ErrorCorrectionProtocol(default_policy=True, policies=None))
--keys--
dict_keys(['scf_eigenvalues_a', 'scf_orbitals_a', 'basis', 'restricted', 'orbitals_a', 'eigenvalues_a'])
==from record==
ResultProtocols(wavefunction=<WavefunctionProtocolEnum.orbitals_and_eigenvalues: 'orbitals_and_eigenvalues'>, stdout=True, error_correction=ErrorCorrectionProtocol(default_policy=True, policies=None))
--keys--
dict_keys(['scf_eigenvalues_a', 'scf_orbitals_a', 'basis', 'restricted', 'orbitals_a', 'eigenvalues_a'])
==from record==
ResultProtocols(wavefunction=<WavefunctionProtocolEnum.orbitals_and_eigenvalues: 'orbitals_and_eigenvalues'>, stdout=True, error_correction=ErrorCorrectionProtocol(default_policy=True, policies=None))
--keys--
dict_keys(['scf_eigenvalues_a', 'scf_orbitals_a', 'basis', 'restricted', 'orbitals_a', 'eigenvalues_a'])
==from record==
ResultProtocols(wavefunction=<WavefunctionProtocolEnum.orbitals_and_eigenvalues: 'orbitals_and_eigenvalues'>, stdout=True, error_correction=ErrorCorrectionProtocol(default_policy=True, policies=None))
--keys--
dict_keys(['scf_eigenvalues_a', 'scf_orbitals_a', 'basis', 'restricted', 'orbitals_a', 'eigenvalues_a'])
[array([-0.3197109604607496,  0.1794879062803129,  0.1794879202986364,
        0.1797173931712172,  0.0496744505239594,  0.2437810967288745,
        0.2437810967288745,  0.2437810967288745]), array([-0.3937946120790922,  0.1001511612568583,  0.1090162732822275,
        0.1091431653405817,  0.8313363619253046, -0.5887027692587685,
       -0.7338852409405476,  0.3477534011840195,  0.1600005241268095,
       -0.201460617408299 ,  0.0696338283298676,  0.0696338283298676,
        0.0696338283298676, -0.201460617408299 ,  0.0696338283298676,
        0.0696338283298676,  0.0696338283298676,  0.6163            ,
       -0.5722            , -0.3450740825574308,  0.2418314299341368,
       -0.2619433879925587,  0.1324804160124179,  0.1238746396718007,
        0.1088309849316341])]
[array([-0.2416,  0.1646,  0.1647,  0.1653, -0.0735,  0.2735,  0.2735,
        0.2735]), array([-0.6331,  0.1595,  0.1615,  0.1619,  1.018 , -0.6328, -0.8731,
        0.3851,  0.2953, -0.4215,  0.1261,  0.1261,  0.1261, -0.4215,
        0.1261,  0.1261,  0.1261,  0.6163, -0.5722, -0.3223,  0.2428,
       -0.3687,  0.1598,  0.1515,  0.1369])]
----------------------------- Captured stderr call -----------------------------
qcwavefunction-construction:   0%|          | 0/10 [00:00<?, ?it/s]qcwavefunction-construction:  30%|███       | 3/10 [00:00<00:00, 24.31it/s]qcwavefunction-construction:  60%|██████    | 6/10 [00:00<00:00, 20.99it/s]qcwavefunction-construction:  90%|█████████ | 9/10 [00:00<00:00, 19.50it/s]qcwavefunction-construction: 100%|██████████| 10/10 [00:00<00:00, 20.64it/s]
------------------------------ Captured log call -------------------------------
INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 6.52ms
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 7.00ms
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 8.54ms
INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 6.33ms
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 6.84ms
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 7.81ms
INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 6.37ms
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 6.77ms
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 6.49ms
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.application:handlers.py:218 QueueManager: Received completed tasks from FractalServer-hpc3-22-04-c2018a32-415c-427e-9fb0-47b2af17dbe9.
INFO     tornado.application:handlers.py:219               Task ids: 70
INFO     tornado.application:handlers.py:289 QueueManager: Found 1 complete tasks (1 successful, 0 failed).
ERROR    tornado.application:web.py:1789 Uncaught exception POST /queue_manager (::1)
HTTPServerRequest(protocol='http', host='localhost:50287', method='POST', uri='/queue_manager', version='HTTP/1.1', remote_ip='::1')
Traceback (most recent call last):
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/tornado/web.py", line 1702, in _execute
    result = method(*self.path_args, **self.path_kwargs)
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/qcfractal/queue/handlers.py", line 343, in post
    success, error = self.insert_complete_tasks(self.storage, body, self.logger)
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/qcfractal/queue/handlers.py", line 299, in insert_complete_tasks
    com = procedure_parser.handle_completed_output(v)
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/qcfractal/procedures/single.py", line 293, in handle_completed_output
    self.storage.update_results(updates)
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/qcfractal/storage_sockets/sqlalchemy_socket.py", line 1330, in update_results
    session.commit()
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1046, in commit
    self.transaction.commit()
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 504, in commit
    self._prepare_impl()
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 483, in _prepare_impl
    self.session.flush()
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 2540, in flush
    self._flush(objects)
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 2682, in _flush
    transaction.rollback(_capture_exception=True)
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 68, in __exit__
    compat.raise_(
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 182, in raise_
    raise exception
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 2642, in _flush
    flush_context.execute()
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 422, in execute
    rec.execute(self)
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 586, in execute
    persistence.save_obj(
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 230, in save_obj
    _emit_update_statements(
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 885, in _emit_update_statements
    for (
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 626, in _collect_update_commands
    state.manager[propkey].impl.is_equal(
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/sqlalchemy/sql/type_api.py", line 1367, in compare_values
    return self.impl.compare_values(x, y)
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/sqlalchemy/sql/type_api.py", line 381, in compare_values
    return x == y
ValueError: The truth value of an array with more than one element is ambiguous. Use a.any() or a.all()
ERROR    tornado.access:web.py:2239 500 POST /queue_manager (::1) 145.51ms
WARNING  tornado.application:managers.py:583 Post complete tasks was not successful. Attempting again on next update.
INFO     tornado.application:managers.py:622 Processed 1 tasks: 1 succeeded / 0 failed).
INFO     tornado.application:managers.py:623 Task ids, submission status, calculation status below
INFO     tornado.application:managers.py:625     Task 70 : deferred / success
INFO     tornado.application:managers.py:679 Task Stats: Processed=1, Failed=0, Success=100.00%
INFO     tornado.application:managers.py:681 Worker Stats (est.): Core Hours Used=0.02, Core Usage Efficiency: 99.27%
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 7.78ms
INFO     tornado.application:handlers.py:218 QueueManager: Received completed tasks from FractalServer-hpc3-22-04-c2018a32-415c-427e-9fb0-47b2af17dbe9.
INFO     tornado.application:handlers.py:219               Task ids: 70
INFO     tornado.application:handlers.py:289 QueueManager: Found 1 complete tasks (1 successful, 0 failed).
ERROR    tornado.application:web.py:1789 Uncaught exception POST /queue_manager (::1)
HTTPServerRequest(protocol='http', host='localhost:50287', method='POST', uri='/queue_manager', version='HTTP/1.1', remote_ip='::1')
Traceback (most recent call last):
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/tornado/web.py", line 1702, in _execute
    result = method(*self.path_args, **self.path_kwargs)
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/qcfractal/queue/handlers.py", line 343, in post
    success, error = self.insert_complete_tasks(self.storage, body, self.logger)
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/qcfractal/queue/handlers.py", line 299, in insert_complete_tasks
    com = procedure_parser.handle_completed_output(v)
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/qcfractal/procedures/single.py", line 293, in handle_completed_output
    self.storage.update_results(updates)
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/qcfractal/storage_sockets/sqlalchemy_socket.py", line 1330, in update_results
    session.commit()
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1046, in commit
    self.transaction.commit()
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 504, in commit
    self._prepare_impl()
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 483, in _prepare_impl
    self.session.flush()
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 2540, in flush
    self._flush(objects)
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 2682, in _flush
    transaction.rollback(_capture_exception=True)
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/sqlalchemy/util/langhelpers.py", line 68, in __exit__
    compat.raise_(
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 182, in raise_
    raise exception
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 2642, in _flush
    flush_context.execute()
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 422, in execute
    rec.execute(self)
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/sqlalchemy/orm/unitofwork.py", line 586, in execute
    persistence.save_obj(
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 230, in save_obj
    _emit_update_statements(
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 885, in _emit_update_statements
    for (
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/sqlalchemy/orm/persistence.py", line 626, in _collect_update_commands
    state.manager[propkey].impl.is_equal(
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/sqlalchemy/sql/type_api.py", line 1367, in compare_values
    return self.impl.compare_values(x, y)
  File "/data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/sqlalchemy/sql/type_api.py", line 381, in compare_values
    return x == y
ValueError: The truth value of an array with more than one element is ambiguous. Use a.any() or a.all()
ERROR    tornado.access:web.py:2239 500 POST /queue_manager (::1) 37.59ms
WARNING  tornado.application:managers.py:500 Could not post jobs from 1 ago and over attempt limit, marking jobs as stale.
INFO     tornado.application:managers.py:679 Task Stats: Processed=1, Failed=0, Success=100.00%
INFO     tornado.application:managers.py:681 Worker Stats (est.): Core Hours Used=0.02, Core Usage Efficiency: 96.63%
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 19.29ms
_ TestMultiResp.test_charge_constraints[False-0.01-/dfs6/pub/lilyw7/pydev/psiresp/psiresp/tests/data/charges/amm_dimethyl_respA2.dat] _

self = <test_job.TestMultiResp object at 0x7f3d6ca1a5e0>
nme2ala2 = Molecule(name=C7H14N2O2, charge=0) with 2 conformers
methylammonium = Molecule(name=CH6N, charge=1) with 1 conformers
methylammonium_nme2ala2_charge_constraints = ChargeConstraintOptions(charge_sum_constraints=[ChargeSumConstraint(atoms={Atom(index=23, molecule=Molecule(name=C7H14...ex=6, molecule=Molecule(name=CH6N, charge=1) with 1 conformers)})], symmetric_methyls=False, symmetric_methylenes=True)
stage_2 = False, resp_a = 0.01
red_charges = [array([-0.5336,  0.2111,  0.2111,  0.2087,  0.4017,  0.167 ,  0.167 ,
        0.167 ]), array([ 0.0131,  0.0178,  0.0...091,
        0.0158,  0.0158,  0.0158,  0.6163, -0.5722, -0.33  ,  0.2059,
       -0.039 ,  0.0628,  0.0473,  0.053 ])]
fractal_client = FractalClient(server_name='QCFractal Server', address='https://hpc3-l18-05:7777/', username='None')
job_esps = {'0c7e913c4a8462f7181fc25edf913be91be8d7c4': array([0.0352396497189797, 0.0201718178403816, 0.0161697547396198, ...,
 ....1636058459170928,
       0.1675559689370116, 0.1614454272167087, 0.1591318125841346,
       0.1597205214363893]), ...}
job_grids = {'0c7e913c4a8462f7181fc25edf913be91be8d7c4': array([[-1.3723571286992204,  4.006524139220508 ,  3.6675488955960907],
 ....2996193717060396,  1.3485806710094863],
       [ 3.987635647849548 , -1.485481850970714 ,  1.3485806710094863]]), ...}

    @pytest.mark.parametrize("stage_2, resp_a, red_charges", [
        (False, 0.0, AMM_NME_OPT_ESPA1_CHARGES),
        (False, 0.01, AMM_NME_OPT_RESPA2_CHARGES),
        (True, 0.0005, AMM_NME_OPT_RESPA1_CHARGES),
    ], indirect=['red_charges'])
    def test_charge_constraints(self, nme2ala2, methylammonium,
                                methylammonium_nme2ala2_charge_constraints,
                                stage_2, resp_a, red_charges,
                                fractal_client, job_esps, job_grids):
    
        resp_options = RespOptions(stage_2=stage_2, resp_a=resp_a)
        job = Job(molecules=[methylammonium, nme2ala2],
                  charge_constraints=methylammonium_nme2ala2_charge_constraints,
                  resp_options=resp_options)
        job.compute_orientation_energies(client=fractal_client)
        # job.compute_esps()
        for mol in job.molecules:
            for conf in mol.conformers:
                for orient in conf.orientations:
                    fname = orient.qcmol.get_hash()
                    orient.esp = job_esps[fname]
                    orient.grid = job_grids[fname]
                    # np.savetxt(f"{fname}_esp.dat", orient.esp)
                    # np.savetxt(f"{fname}_grid.dat", orient.grid)
        job.compute_charges()
        charges = np.concatenate(job.charges)
        print(job.charges)
    
        print(red_charges)
    
        assert_allclose(charges[[0, 1, 2, 3, 8, 9, 10, 11, 12, 13, 14, 15]].sum(), 0, atol=1e-7)
        assert_allclose(charges[[27, 28, 29, 30, 31, 32]].sum(), 0, atol=1e-7)
        assert_allclose(charges[25], 0.6163)
        assert_allclose(charges[26], -0.5722)
        assert_allclose(charges[18], charges[22])
        for calculated, reference in zip(job.charges[::-1], red_charges[::-1]):
>           assert_allclose(calculated, reference)
E           AssertionError: 
E           Not equal to tolerance rtol=1e-07, atol=0
E           
E           Mismatched elements: 23 / 25 (92%)
E           Max absolute difference: 0.7613363619253046
E           Max relative difference: 31.060657410617726
E            x: array([-0.393795,  0.100151,  0.109016,  0.109143,  0.831336, -0.588703,
E                  -0.733885,  0.347753,  0.160001, -0.201461,  0.069634,  0.069634,
E                   0.069634, -0.201461,  0.069634,  0.069634,  0.069634,  0.6163  ,...
E            y: array([ 0.0131,  0.0178,  0.0634,  0.0484,  0.07  , -0.3759, -0.0901,
E                   0.156 , -0.0234, -0.0091,  0.0158,  0.0158,  0.0158, -0.0091,
E                   0.0158,  0.0158,  0.0158,  0.6163, -0.5722, -0.33  ,  0.2059,
E                  -0.039 ,  0.0628,  0.0473,  0.053 ])

test_job.py:82: AssertionError
----------------------------- Captured stdout call -----------------------------
==from record==
ResultProtocols(wavefunction=<WavefunctionProtocolEnum.orbitals_and_eigenvalues: 'orbitals_and_eigenvalues'>, stdout=True, error_correction=ErrorCorrectionProtocol(default_policy=True, policies=None))
--keys--
dict_keys(['scf_eigenvalues_a', 'scf_orbitals_a', 'basis', 'restricted', 'orbitals_a', 'eigenvalues_a'])
==from record==
ResultProtocols(wavefunction=<WavefunctionProtocolEnum.orbitals_and_eigenvalues: 'orbitals_and_eigenvalues'>, stdout=True, error_correction=ErrorCorrectionProtocol(default_policy=True, policies=None))
--keys--
dict_keys(['scf_eigenvalues_a', 'scf_orbitals_a', 'basis', 'restricted', 'orbitals_a', 'eigenvalues_a'])
==from record==
ResultProtocols(wavefunction=<WavefunctionProtocolEnum.orbitals_and_eigenvalues: 'orbitals_and_eigenvalues'>, stdout=True, error_correction=ErrorCorrectionProtocol(default_policy=True, policies=None))
--keys--
dict_keys(['scf_eigenvalues_a', 'scf_orbitals_a', 'basis', 'restricted', 'orbitals_a', 'eigenvalues_a'])
==from record==
ResultProtocols(wavefunction=<WavefunctionProtocolEnum.orbitals_and_eigenvalues: 'orbitals_and_eigenvalues'>, stdout=True, error_correction=ErrorCorrectionProtocol(default_policy=True, policies=None))
--keys--
dict_keys(['scf_eigenvalues_a', 'scf_orbitals_a', 'basis', 'restricted', 'orbitals_a', 'eigenvalues_a'])
==from record==
ResultProtocols(wavefunction=<WavefunctionProtocolEnum.orbitals_and_eigenvalues: 'orbitals_and_eigenvalues'>, stdout=True, error_correction=ErrorCorrectionProtocol(default_policy=True, policies=None))
--keys--
dict_keys(['scf_eigenvalues_a', 'scf_orbitals_a', 'basis', 'restricted', 'orbitals_a', 'eigenvalues_a'])
==from record==
ResultProtocols(wavefunction=<WavefunctionProtocolEnum.orbitals_and_eigenvalues: 'orbitals_and_eigenvalues'>, stdout=True, error_correction=ErrorCorrectionProtocol(default_policy=True, policies=None))
--keys--
dict_keys(['scf_eigenvalues_a', 'scf_orbitals_a', 'basis', 'restricted', 'orbitals_a', 'eigenvalues_a'])
==from record==
ResultProtocols(wavefunction=<WavefunctionProtocolEnum.orbitals_and_eigenvalues: 'orbitals_and_eigenvalues'>, stdout=True, error_correction=ErrorCorrectionProtocol(default_policy=True, policies=None))
--keys--
dict_keys(['scf_eigenvalues_a', 'scf_orbitals_a', 'basis', 'restricted', 'orbitals_a', 'eigenvalues_a'])
==from record==
ResultProtocols(wavefunction=<WavefunctionProtocolEnum.orbitals_and_eigenvalues: 'orbitals_and_eigenvalues'>, stdout=True, error_correction=ErrorCorrectionProtocol(default_policy=True, policies=None))
--keys--
dict_keys(['scf_eigenvalues_a', 'scf_orbitals_a', 'basis', 'restricted', 'orbitals_a', 'eigenvalues_a'])
==from record==
ResultProtocols(wavefunction=<WavefunctionProtocolEnum.orbitals_and_eigenvalues: 'orbitals_and_eigenvalues'>, stdout=True, error_correction=ErrorCorrectionProtocol(default_policy=True, policies=None))
--keys--
dict_keys(['scf_eigenvalues_a', 'scf_orbitals_a', 'basis', 'restricted', 'orbitals_a', 'eigenvalues_a'])
==from record==
ResultProtocols(wavefunction=<WavefunctionProtocolEnum.orbitals_and_eigenvalues: 'orbitals_and_eigenvalues'>, stdout=True, error_correction=ErrorCorrectionProtocol(default_policy=True, policies=None))
--keys--
dict_keys(['scf_eigenvalues_a', 'scf_orbitals_a', 'basis', 'restricted', 'orbitals_a', 'eigenvalues_a'])
[array([-0.3197109604607496,  0.1794879062803129,  0.1794879202986364,
        0.1797173931712172,  0.0496744505239594,  0.2437810967288745,
        0.2437810967288745,  0.2437810967288745]), array([-0.3937946120790922,  0.1001511612568583,  0.1090162732822275,
        0.1091431653405817,  0.8313363619253046, -0.5887027692587685,
       -0.7338852409405476,  0.3477534011840195,  0.1600005241268095,
       -0.201460617408299 ,  0.0696338283298676,  0.0696338283298676,
        0.0696338283298676, -0.201460617408299 ,  0.0696338283298676,
        0.0696338283298676,  0.0696338283298676,  0.6163            ,
       -0.5722            , -0.3450740825574308,  0.2418314299341368,
       -0.2619433879925587,  0.1324804160124179,  0.1238746396718007,
        0.1088309849316341])]
[array([-0.5336,  0.2111,  0.2111,  0.2087,  0.4017,  0.167 ,  0.167 ,
        0.167 ]), array([ 0.0131,  0.0178,  0.0634,  0.0484,  0.07  , -0.3759, -0.0901,
        0.156 , -0.0234, -0.0091,  0.0158,  0.0158,  0.0158, -0.0091,
        0.0158,  0.0158,  0.0158,  0.6163, -0.5722, -0.33  ,  0.2059,
       -0.039 ,  0.0628,  0.0473,  0.053 ])]
----------------------------- Captured stderr call -----------------------------
qcwavefunction-construction:   0%|          | 0/10 [00:00<?, ?it/s]qcwavefunction-construction:  20%|██        | 2/10 [00:00<00:00, 18.38it/s]qcwavefunction-construction:  50%|█████     | 5/10 [00:00<00:00, 20.31it/s]qcwavefunction-construction:  80%|████████  | 8/10 [00:00<00:00, 19.00it/s]qcwavefunction-construction: 100%|██████████| 10/10 [00:00<00:00, 18.83it/s]qcwavefunction-construction: 100%|██████████| 10/10 [00:00<00:00, 19.01it/s]
------------------------------ Captured log call -------------------------------
INFO     tornado.application:managers.py:679 Task Stats: Processed=1, Failed=0, Success=100.00%
INFO     tornado.application:managers.py:681 Worker Stats (est.): Core Hours Used=0.02, Core Usage Efficiency: 94.28%
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 7.47ms
INFO     tornado.application:managers.py:679 Task Stats: Processed=1, Failed=0, Success=100.00%
INFO     tornado.application:managers.py:681 Worker Stats (est.): Core Hours Used=0.02, Core Usage Efficiency: 92.10%
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 9.09ms
INFO     tornado.application:managers.py:679 Task Stats: Processed=1, Failed=0, Success=100.00%
INFO     tornado.application:managers.py:681 Worker Stats (est.): Core Hours Used=0.02, Core Usage Efficiency: 90.02%
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 10.42ms
INFO     tornado.application:managers.py:679 Task Stats: Processed=1, Failed=0, Success=100.00%
INFO     tornado.application:managers.py:681 Worker Stats (est.): Core Hours Used=0.03, Core Usage Efficiency: 88.03%
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 7.99ms
INFO     tornado.application:managers.py:679 Task Stats: Processed=1, Failed=0, Success=100.00%
INFO     tornado.application:managers.py:681 Worker Stats (est.): Core Hours Used=0.03, Core Usage Efficiency: 86.13%
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 8.42ms
INFO     tornado.application:managers.py:679 Task Stats: Processed=1, Failed=0, Success=100.00%
INFO     tornado.application:managers.py:681 Worker Stats (est.): Core Hours Used=0.03, Core Usage Efficiency: 84.31%
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 6.78ms
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.application:managers.py:679 Task Stats: Processed=1, Failed=0, Success=100.00%
INFO     tornado.application:managers.py:681 Worker Stats (est.): Core Hours Used=0.03, Core Usage Efficiency: 82.56%
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 7.91ms
INFO     tornado.application:managers.py:679 Task Stats: Processed=1, Failed=0, Success=100.00%
INFO     tornado.application:managers.py:681 Worker Stats (est.): Core Hours Used=0.03, Core Usage Efficiency: 80.89%
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 9.01ms
INFO     tornado.application:managers.py:679 Task Stats: Processed=1, Failed=0, Success=100.00%
INFO     tornado.application:managers.py:681 Worker Stats (est.): Core Hours Used=0.03, Core Usage Efficiency: 79.28%
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 6.81ms
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.application:managers.py:679 Task Stats: Processed=1, Failed=0, Success=100.00%
INFO     tornado.application:managers.py:681 Worker Stats (est.): Core Hours Used=0.03, Core Usage Efficiency: 77.73%
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 7.73ms
INFO     tornado.application:managers.py:679 Task Stats: Processed=1, Failed=0, Success=100.00%
INFO     tornado.application:managers.py:681 Worker Stats (est.): Core Hours Used=0.03, Core Usage Efficiency: 76.24%
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 8.86ms
_ TestMultiResp.test_charge_constraints[True-0.0005-/dfs6/pub/lilyw7/pydev/psiresp/psiresp/tests/data/charges/amm_dimethyl_respA1.dat] _

self = <test_job.TestMultiResp object at 0x7f3d6c3845e0>
nme2ala2 = Molecule(name=C7H14N2O2, charge=0) with 2 conformers
methylammonium = Molecule(name=CH6N, charge=1) with 1 conformers
methylammonium_nme2ala2_charge_constraints = ChargeConstraintOptions(charge_sum_constraints=[ChargeSumConstraint(atoms={Atom(index=23, molecule=Molecule(name=C7H14...ex=6, molecule=Molecule(name=CH6N, charge=1) with 1 conformers)})], symmetric_methyls=False, symmetric_methylenes=True)
stage_2 = True, resp_a = 0.0005
red_charges = [array([-0.3119,  0.1777,  0.1777,  0.1779,  0.0433,  0.2451,  0.2451,
        0.2451]), array([-0.3689,  0.099 ,  0.1...961,
        0.0912,  0.0912,  0.0912,  0.6163, -0.5722, -0.3301,  0.2352,
       -0.2746,  0.1348,  0.1195,  0.1152])]
fractal_client = FractalClient(server_name='QCFractal Server', address='https://hpc3-l18-05:7777/', username='None')
job_esps = {'0c7e913c4a8462f7181fc25edf913be91be8d7c4': array([0.0352396497189797, 0.0201718178403816, 0.0161697547396198, ...,
 ....1636058459170928,
       0.1675559689370116, 0.1614454272167087, 0.1591318125841346,
       0.1597205214363893]), ...}
job_grids = {'0c7e913c4a8462f7181fc25edf913be91be8d7c4': array([[-1.3723571286992204,  4.006524139220508 ,  3.6675488955960907],
 ....2996193717060396,  1.3485806710094863],
       [ 3.987635647849548 , -1.485481850970714 ,  1.3485806710094863]]), ...}

    @pytest.mark.parametrize("stage_2, resp_a, red_charges", [
        (False, 0.0, AMM_NME_OPT_ESPA1_CHARGES),
        (False, 0.01, AMM_NME_OPT_RESPA2_CHARGES),
        (True, 0.0005, AMM_NME_OPT_RESPA1_CHARGES),
    ], indirect=['red_charges'])
    def test_charge_constraints(self, nme2ala2, methylammonium,
                                methylammonium_nme2ala2_charge_constraints,
                                stage_2, resp_a, red_charges,
                                fractal_client, job_esps, job_grids):
    
        resp_options = RespOptions(stage_2=stage_2, resp_a=resp_a)
        job = Job(molecules=[methylammonium, nme2ala2],
                  charge_constraints=methylammonium_nme2ala2_charge_constraints,
                  resp_options=resp_options)
        job.compute_orientation_energies(client=fractal_client)
        # job.compute_esps()
        for mol in job.molecules:
            for conf in mol.conformers:
                for orient in conf.orientations:
                    fname = orient.qcmol.get_hash()
                    orient.esp = job_esps[fname]
                    orient.grid = job_grids[fname]
                    # np.savetxt(f"{fname}_esp.dat", orient.esp)
                    # np.savetxt(f"{fname}_grid.dat", orient.grid)
>       job.compute_charges()

test_job.py:70: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../job.py:190: in compute_charges
    stage_2_constraints.add_constraints_from_charges(self.stage_1_charges._charges)
../charge.py:362: in add_constraints_from_charges
    self.clean_charge_sum_constraints()
../charge.py:230: in clean_charge_sum_constraints
    self._remove_redundant_charge_constraints()
../charge.py:207: in _remove_redundant_charge_constraints
    single_charges = self._get_single_atom_charge_constraints()
../charge.py:171: in _get_single_atom_charge_constraints
    if atom in single_charges:
../molecule.py:172: in __eq__
    return self.molecule == other.molecule and self.index == other.index
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   ValueError: The truth value of an array with more than one element is ambiguous. Use a.any() or a.all()

pydantic/main.py:922: ValueError
------------------------------ Captured log setup ------------------------------
INFO     tornado.application:managers.py:679 Task Stats: Processed=1, Failed=0, Success=100.00%
INFO     tornado.application:managers.py:681 Worker Stats (est.): Core Hours Used=0.03, Core Usage Efficiency: 74.81%
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 7.91ms
----------------------------- Captured stdout call -----------------------------
==from record==
ResultProtocols(wavefunction=<WavefunctionProtocolEnum.orbitals_and_eigenvalues: 'orbitals_and_eigenvalues'>, stdout=True, error_correction=ErrorCorrectionProtocol(default_policy=True, policies=None))
--keys--
dict_keys(['scf_eigenvalues_a', 'scf_orbitals_a', 'basis', 'restricted', 'orbitals_a', 'eigenvalues_a'])
==from record==
ResultProtocols(wavefunction=<WavefunctionProtocolEnum.orbitals_and_eigenvalues: 'orbitals_and_eigenvalues'>, stdout=True, error_correction=ErrorCorrectionProtocol(default_policy=True, policies=None))
--keys--
dict_keys(['scf_eigenvalues_a', 'scf_orbitals_a', 'basis', 'restricted', 'orbitals_a', 'eigenvalues_a'])
==from record==
ResultProtocols(wavefunction=<WavefunctionProtocolEnum.orbitals_and_eigenvalues: 'orbitals_and_eigenvalues'>, stdout=True, error_correction=ErrorCorrectionProtocol(default_policy=True, policies=None))
--keys--
dict_keys(['scf_eigenvalues_a', 'scf_orbitals_a', 'basis', 'restricted', 'orbitals_a', 'eigenvalues_a'])
==from record==
ResultProtocols(wavefunction=<WavefunctionProtocolEnum.orbitals_and_eigenvalues: 'orbitals_and_eigenvalues'>, stdout=True, error_correction=ErrorCorrectionProtocol(default_policy=True, policies=None))
--keys--
dict_keys(['scf_eigenvalues_a', 'scf_orbitals_a', 'basis', 'restricted', 'orbitals_a', 'eigenvalues_a'])
==from record==
ResultProtocols(wavefunction=<WavefunctionProtocolEnum.orbitals_and_eigenvalues: 'orbitals_and_eigenvalues'>, stdout=True, error_correction=ErrorCorrectionProtocol(default_policy=True, policies=None))
--keys--
dict_keys(['scf_eigenvalues_a', 'scf_orbitals_a', 'basis', 'restricted', 'orbitals_a', 'eigenvalues_a'])
==from record==
ResultProtocols(wavefunction=<WavefunctionProtocolEnum.orbitals_and_eigenvalues: 'orbitals_and_eigenvalues'>, stdout=True, error_correction=ErrorCorrectionProtocol(default_policy=True, policies=None))
--keys--
dict_keys(['scf_eigenvalues_a', 'scf_orbitals_a', 'basis', 'restricted', 'orbitals_a', 'eigenvalues_a'])
==from record==
ResultProtocols(wavefunction=<WavefunctionProtocolEnum.orbitals_and_eigenvalues: 'orbitals_and_eigenvalues'>, stdout=True, error_correction=ErrorCorrectionProtocol(default_policy=True, policies=None))
--keys--
dict_keys(['scf_eigenvalues_a', 'scf_orbitals_a', 'basis', 'restricted', 'orbitals_a', 'eigenvalues_a'])
==from record==
ResultProtocols(wavefunction=<WavefunctionProtocolEnum.orbitals_and_eigenvalues: 'orbitals_and_eigenvalues'>, stdout=True, error_correction=ErrorCorrectionProtocol(default_policy=True, policies=None))
--keys--
dict_keys(['scf_eigenvalues_a', 'scf_orbitals_a', 'basis', 'restricted', 'orbitals_a', 'eigenvalues_a'])
==from record==
ResultProtocols(wavefunction=<WavefunctionProtocolEnum.orbitals_and_eigenvalues: 'orbitals_and_eigenvalues'>, stdout=True, error_correction=ErrorCorrectionProtocol(default_policy=True, policies=None))
--keys--
dict_keys(['scf_eigenvalues_a', 'scf_orbitals_a', 'basis', 'restricted', 'orbitals_a', 'eigenvalues_a'])
==from record==
ResultProtocols(wavefunction=<WavefunctionProtocolEnum.orbitals_and_eigenvalues: 'orbitals_and_eigenvalues'>, stdout=True, error_correction=ErrorCorrectionProtocol(default_policy=True, policies=None))
--keys--
dict_keys(['scf_eigenvalues_a', 'scf_orbitals_a', 'basis', 'restricted', 'orbitals_a', 'eigenvalues_a'])
----------------------------- Captured stderr call -----------------------------
qcwavefunction-construction:   0%|          | 0/10 [00:00<?, ?it/s]qcwavefunction-construction:  20%|██        | 2/10 [00:00<00:00, 18.01it/s]qcwavefunction-construction:  40%|████      | 4/10 [00:00<00:00, 18.10it/s]qcwavefunction-construction:  60%|██████    | 6/10 [00:00<00:00, 18.47it/s]qcwavefunction-construction:  90%|█████████ | 9/10 [00:00<00:00, 19.74it/s]qcwavefunction-construction: 100%|██████████| 10/10 [00:00<00:00, 19.09it/s]
------------------------------ Captured log call -------------------------------
INFO     tornado.application:managers.py:679 Task Stats: Processed=1, Failed=0, Success=100.00%
INFO     tornado.application:managers.py:681 Worker Stats (est.): Core Hours Used=0.03, Core Usage Efficiency: 73.43%
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 7.66ms
INFO     tornado.application:managers.py:679 Task Stats: Processed=1, Failed=0, Success=100.00%
INFO     tornado.application:managers.py:681 Worker Stats (est.): Core Hours Used=0.03, Core Usage Efficiency: 72.11%
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 6.44ms
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.application:managers.py:679 Task Stats: Processed=1, Failed=0, Success=100.00%
INFO     tornado.application:managers.py:681 Worker Stats (est.): Core Hours Used=0.03, Core Usage Efficiency: 70.83%
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 7.76ms
INFO     tornado.application:managers.py:679 Task Stats: Processed=1, Failed=0, Success=100.00%
INFO     tornado.application:managers.py:681 Worker Stats (est.): Core Hours Used=0.03, Core Usage Efficiency: 69.59%
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 7.86ms
INFO     tornado.application:managers.py:679 Task Stats: Processed=1, Failed=0, Success=100.00%
INFO     tornado.application:managers.py:681 Worker Stats (est.): Core Hours Used=0.03, Core Usage Efficiency: 68.40%
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 6.47ms
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.application:managers.py:679 Task Stats: Processed=1, Failed=0, Success=100.00%
INFO     tornado.application:managers.py:681 Worker Stats (est.): Core Hours Used=0.03, Core Usage Efficiency: 67.24%
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 7.74ms
INFO     tornado.application:managers.py:679 Task Stats: Processed=1, Failed=0, Success=100.00%
INFO     tornado.application:managers.py:681 Worker Stats (est.): Core Hours Used=0.03, Core Usage Efficiency: 66.13%
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 7.84ms
INFO     tornado.application:managers.py:679 Task Stats: Processed=1, Failed=0, Success=100.00%
INFO     tornado.application:managers.py:681 Worker Stats (est.): Core Hours Used=0.03, Core Usage Efficiency: 65.05%
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 6.42ms
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.application:managers.py:679 Task Stats: Processed=1, Failed=0, Success=100.00%
INFO     tornado.application:managers.py:681 Worker Stats (est.): Core Hours Used=0.03, Core Usage Efficiency: 64.00%
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 7.70ms
INFO     tornado.application:managers.py:679 Task Stats: Processed=1, Failed=0, Success=100.00%
INFO     tornado.application:managers.py:681 Worker Stats (est.): Core Hours Used=0.04, Core Usage Efficiency: 62.99%
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 7.87ms
INFO     tornado.application:managers.py:679 Task Stats: Processed=1, Failed=0, Success=100.00%
INFO     tornado.application:managers.py:681 Worker Stats (est.): Core Hours Used=0.04, Core Usage Efficiency: 62.01%
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 11.09ms
---------------------------- Captured log teardown -----------------------------
INFO     tornado.application:managers.py:358 QueueManager received shutdown signal: Not provided.

INFO     tornado.application:managers.py:679 Task Stats: Processed=1, Failed=0, Success=100.00%
INFO     tornado.application:managers.py:681 Worker Stats (est.): Core Hours Used=0.04, Core Usage Efficiency: 60.91%
INFO     tornado.application:handlers.py:389 QueueManager: Shutdown of manager FractalServer-hpc3-22-04-c2018a32-415c-427e-9fb0-47b2af17dbe9 detected, recycling 6 incomplete tasks.
INFO     tornado.application:managers.py:431 Shutdown was successful, 0 active and 6 stale tasks returned to master queue.
INFO     tornado.access:web.py:2239 200 PUT /queue_manager (::1) 11.97ms
INFO     tornado.application:managers.py:375 QueueManager stopping gracefully.

INFO     tornado.application:server.py:456 FractalServer stopping gracefully. Stopped IOLoop.
=============================== warnings summary ===============================
../../../../../../../data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/past/builtins/misc.py:45
  /data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/past/builtins/misc.py:45: DeprecationWarning: the imp module is deprecated in favour of importlib; see the module's documentation for alternative uses
    from imp import reload

psiresp/tests/test_job.py: 66 warnings
  /data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/qcelemental/models/results.py:735: DeprecationWarning: ResultProtocols has been renamed to AtomicResultProtocols and will be removed in v0.13.0
    warn(

psiresp/tests/test_job.py: 66 warnings
  /data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/qcelemental/models/results.py:724: DeprecationWarning: ResultProperties has been renamed to AtomicResultProperties and will be removed in v0.13.0
    warn(

psiresp/tests/test_job.py::TestSingleResp::test_unrestrained
psiresp/tests/test_job.py::TestSingleResp::test_restrained
psiresp/tests/test_job.py::TestMultiResp::test_charge_constraints[False-0.0-/dfs6/pub/lilyw7/pydev/psiresp/psiresp/tests/data/charges/amm_dimethyl_espA1.dat]
psiresp/tests/test_job.py::TestMultiResp::test_charge_constraints[False-0.01-/dfs6/pub/lilyw7/pydev/psiresp/psiresp/tests/data/charges/amm_dimethyl_respA2.dat]
psiresp/tests/test_job.py::TestMultiResp::test_charge_constraints[True-0.0005-/dfs6/pub/lilyw7/pydev/psiresp/psiresp/tests/data/charges/amm_dimethyl_respA1.dat]
  /data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/numpy/matrixlib/defmatrix.py:1109: PendingDeprecationWarning: the matrix subclass is not the recommended way to represent matrices or deal with linear algebra (see https://docs.scipy.org/doc/numpy/user/numpy-for-matlab-users.html). Please adjust your code to use regular ndarray.
    return matrix(concatenate(arr_rows, axis=0))

psiresp/tests/test_job.py: 81 warnings
  /data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/urllib3/connectionpool.py:1013: InsecureRequestWarning: Unverified HTTPS request is being made to host 'hpc3-l18-05'. Adding certificate verification is strongly advised. See: https://urllib3.readthedocs.io/en/1.26.x/advanced-usage.html#ssl-warnings
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/warnings.html
=========================== short test summary info ============================
FAILED test_job.py::TestSingleResp::test_unrestrained - AssertionError: 
FAILED test_job.py::TestSingleResp::test_restrained - AssertionError: 
FAILED test_job.py::TestMultiResp::test_charge_constraints[False-0.0-/dfs6/pub/lilyw7/pydev/psiresp/psiresp/tests/data/charges/amm_dimethyl_espA1.dat]
FAILED test_job.py::TestMultiResp::test_charge_constraints[False-0.01-/dfs6/pub/lilyw7/pydev/psiresp/psiresp/tests/data/charges/amm_dimethyl_respA2.dat]
FAILED test_job.py::TestMultiResp::test_charge_constraints[True-0.0005-/dfs6/pub/lilyw7/pydev/psiresp/psiresp/tests/data/charges/amm_dimethyl_respA1.dat]
================= 5 failed, 219 warnings in 192.96s (0:03:12) ==================
