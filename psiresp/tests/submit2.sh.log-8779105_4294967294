============================= test session starts ==============================
platform linux -- Python 3.8.12, pytest-6.2.4, py-1.10.0, pluggy-0.13.1
rootdir: /dfs6/pub/lilyw7/pydev/psiresp, configfile: pyproject.toml
plugins: qcfractal-0.15.6, requests-mock-1.9.3
collected 9 items

test_grid.py ......FFF                                                   [100%]

=================================== FAILURES ===================================
_ test_generate_vdw_grid[/dfs6/pub/lilyw7/pydev/psiresp/psiresp/tests/data/molecules/dmso_opt_c1.xyz-/dfs6/pub/lilyw7/pydev/psiresp/psiresp/tests/data/surfaces/dmso_opt_c1_grid.npy] _

qcmol = Molecule(name='C2H6OS', formula='C2H6OS', hash='d8fbedf')
reference_grid = array([[  8.1907494         ,   1.34160357        , -14.122849512052678 ],
       [  7.665749399999999 ,   2.250930243...-1.8313186242207333, -13.686856444460961 ],
       [ 10.29454915963744  ,  -2.2705300366825902, -13.686856444460961 ]])
default_grid_options = GridOptions(grid_rmin=0, grid_rmax=-1, use_radii='msk', vdw_radii={}, vdw_scale_factors=[1.4, 1.6, 1.8, 2.0], vdw_point_density=1.0)

    @pytest.mark.parametrize("qcmol, reference_grid", [
        (DMSO, DMSO_GRID),
        (DMSO_O1, DMSO_O1_GRID),
        (DMSO_O2, DMSO_O2_GRID),
    ], indirect=True)
    def test_generate_vdw_grid(qcmol, reference_grid, default_grid_options):
        grid = default_grid_options.generate_grid(qcmol)
>       assert_allclose(grid, reference_grid)
E       AssertionError: 
E       Not equal to tolerance rtol=1e-07, atol=0
E       
E       (shapes (623, 3), (1165, 3) mismatch)
E        x: array([[ 2.033737,  1.22232 , -7.38588 ],
E              [ 1.739744,  1.212509, -8.43588 ],
E              [ 1.739744,  0.207383, -8.43588 ],...
E        y: array([[  8.190749,   1.341604, -14.12285 ],
E              [  7.665749,   2.25093 , -14.12285 ],
E              [  8.670698,   2.324842, -14.891503],...

test_grid.py:54: AssertionError
_ test_generate_vdw_grid[/dfs6/pub/lilyw7/pydev/psiresp/psiresp/tests/data/molecules/dmso_opt_c1_o1.xyz-/dfs6/pub/lilyw7/pydev/psiresp/psiresp/tests/data/surfaces/dmso_opt_c1_o1_grid.npy] _

qcmol = Molecule(name='C2H6OS', formula='C2H6OS', hash='e02f359')
reference_grid = array([[ 1.0499999999999996,  0.                ,  1.818653347947321 ],
       [ 0.5249999999999998, -0.90932667397366...97, -0.791533216875485 , -6.653447922965806 ],
       [ 2.9443866000000005,  0.1102772         , -6.891122640000001 ]])
default_grid_options = GridOptions(grid_rmin=0, grid_rmax=-1, use_radii='msk', vdw_radii={}, vdw_scale_factors=[1.4, 1.6, 1.8, 2.0], vdw_point_density=1.0)

    @pytest.mark.parametrize("qcmol, reference_grid", [
        (DMSO, DMSO_GRID),
        (DMSO_O1, DMSO_O1_GRID),
        (DMSO_O2, DMSO_O2_GRID),
    ], indirect=True)
    def test_generate_vdw_grid(qcmol, reference_grid, default_grid_options):
        grid = default_grid_options.generate_grid(qcmol)
>       assert_allclose(grid, reference_grid)
E       AssertionError: 
E       Not equal to tolerance rtol=1e-07, atol=0
E       
E       (shapes (627, 3), (1167, 3) mismatch)
E        x: array([[-1.744985e+00, -5.123739e-01,  1.050000e+00],
E              [ 2.531270e-01,  2.084689e+00,  1.285879e-16],
E              [-2.038978e+00,  5.025629e-01,  1.285879e-16],...
E        y: array([[ 1.05    ,  0.      ,  1.818653],
E              [ 0.525   , -0.909327,  1.818653],
E              [ 0.755496,  1.654305,  1.05    ],...

test_grid.py:54: AssertionError
_ test_generate_vdw_grid[/dfs6/pub/lilyw7/pydev/psiresp/psiresp/tests/data/molecules/dmso_opt_c1_o2.xyz-/dfs6/pub/lilyw7/pydev/psiresp/psiresp/tests/data/surfaces/dmso_opt_c1_o2_grid.npy] _

qcmol = Molecule(name='C2H6OS', formula='C2H6OS', hash='9897061')
reference_grid = array([[4.83210146        , 3.25112787        , 1.818653347947321 ],
       [3.2571014599999994, 2.34180119602634  , 1...7666936, 1.8807505742207338, 2.9947471155390404],
       [1.0298461464511663, 0.9913071481796241, 2.9947471155390404]])
default_grid_options = GridOptions(grid_rmin=0, grid_rmax=-1, use_radii='msk', vdw_radii={}, vdw_scale_factors=[1.4, 1.6, 1.8, 2.0], vdw_point_density=1.0)

    @pytest.mark.parametrize("qcmol, reference_grid", [
        (DMSO, DMSO_GRID),
        (DMSO_O1, DMSO_O1_GRID),
        (DMSO_O2, DMSO_O2_GRID),
    ], indirect=True)
    def test_generate_vdw_grid(qcmol, reference_grid, default_grid_options):
        grid = default_grid_options.generate_grid(qcmol)
>       assert_allclose(grid, reference_grid)
E       AssertionError: 
E       Not equal to tolerance rtol=1e-07, atol=0
E       
E       (shapes (611, 3), (1148, 3) mismatch)
E        x: array([[ 3.051402e+00,  1.720423e+00,  1.818653e+00],
E              [ 2.756898e+00,  3.374728e+00,  1.050000e+00],
E              [ 2.254529e+00,  3.805111e+00,  1.285879e-16],...
E        y: array([[4.832101, 3.251128, 1.818653],
E              [3.257101, 2.341801, 1.818653],
E              [4.307101, 2.341801, 1.818653],...

test_grid.py:54: AssertionError
=============================== warnings summary ===============================
../../../../../../../data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/past/builtins/misc.py:45
  /data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/past/builtins/misc.py:45: DeprecationWarning: the imp module is deprecated in favour of importlib; see the module's documentation for alternative uses
    from imp import reload

psiresp/tests/test_grid.py::test_generate_connolly_spheres[radii0-0.0-n_points0]
  /dfs6/pub/lilyw7/pydev/psiresp/psiresp/grid.py:102: RuntimeWarning: invalid value encountered in true_divide
    vertical_angles = rows * np.pi / n_longitude_points

-- Docs: https://docs.pytest.org/en/stable/warnings.html
=========================== short test summary info ============================
FAILED test_grid.py::test_generate_vdw_grid[/dfs6/pub/lilyw7/pydev/psiresp/psiresp/tests/data/molecules/dmso_opt_c1.xyz-/dfs6/pub/lilyw7/pydev/psiresp/psiresp/tests/data/surfaces/dmso_opt_c1_grid.npy]
FAILED test_grid.py::test_generate_vdw_grid[/dfs6/pub/lilyw7/pydev/psiresp/psiresp/tests/data/molecules/dmso_opt_c1_o1.xyz-/dfs6/pub/lilyw7/pydev/psiresp/psiresp/tests/data/surfaces/dmso_opt_c1_o1_grid.npy]
FAILED test_grid.py::test_generate_vdw_grid[/dfs6/pub/lilyw7/pydev/psiresp/psiresp/tests/data/molecules/dmso_opt_c1_o2.xyz-/dfs6/pub/lilyw7/pydev/psiresp/psiresp/tests/data/surfaces/dmso_opt_c1_o2_grid.npy]
=================== 3 failed, 6 passed, 2 warnings in 1.28s ====================
============================= test session starts ==============================
platform linux -- Python 3.8.12, pytest-6.2.4, py-1.10.0, pluggy-0.13.1
rootdir: /dfs6/pub/lilyw7/pydev/psiresp, configfile: pyproject.toml
plugins: qcfractal-0.15.6, requests-mock-1.9.3
collected 3 items

test_moleculebase.py FF                                                  [ 66%]
test_molecule.py .                                                       [100%]

=================================== FAILURES ===================================
_______________________ test_generate_atom_combinations ________________________

    def test_generate_atom_combinations():
        symbols = ["H", "C", "C", "O", "N"]
        combinations = generate_atom_combinations(symbols)
        reference = [(1, 2, 3), (3, 2, 1),
                     (1, 2, 4), (4, 2, 1),
                     (1, 3, 4), (4, 3, 1),
                     (2, 3, 4), (4, 3, 2),
                     (1, 2, 0), (0, 2, 1),
                     (1, 3, 0), (0, 3, 1),
                     (1, 4, 0), (0, 4, 1),
                     (2, 3, 0), (0, 3, 2),
                     (2, 4, 0), (0, 4, 2),
                     (3, 4, 0), (0, 4, 3)]
    
>       assert list(combinations) == reference
E       assert [(2, 3, 4), (...5, 4, 2), ...] == [(1, 2, 3), (...4, 3, 1), ...]
E         At index 0 diff: (2, 3, 4) != (1, 2, 3)
E         Use -v to get the full diff

test_moleculebase.py:21: AssertionError
______________________________ test_basemolecule _______________________________

dmso_qcmol = Molecule(name='C2H6OS', formula='C2H6OS', hash='d8fbedf')

    def test_basemolecule(dmso_qcmol):
        mol = BaseMolecule(qcmol=dmso_qcmol)
        assert mol.n_atoms == 10
        assert mol.coordinates.shape == (10, 3)
    
        combinations = mol.generate_atom_combinations(n_combinations=2)
>       assert combinations == [(0, 4, 5), (5, 4, 0)]
E       assert [(1, 5, 6), (6, 5, 1)] == [(0, 4, 5), (5, 4, 0)]
E         At index 0 diff: (1, 5, 6) != (0, 4, 5)
E         Use -v to get the full diff

test_moleculebase.py:30: AssertionError
=============================== warnings summary ===============================
../../../../../../../data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/past/builtins/misc.py:45
  /data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/past/builtins/misc.py:45: DeprecationWarning: the imp module is deprecated in favour of importlib; see the module's documentation for alternative uses
    from imp import reload

-- Docs: https://docs.pytest.org/en/stable/warnings.html
=========================== short test summary info ============================
FAILED test_moleculebase.py::test_generate_atom_combinations - assert [(2, 3,...
FAILED test_moleculebase.py::test_basemolecule - assert [(1, 5, 6), (6, 5, 1)...
==================== 2 failed, 1 passed, 1 warning in 0.74s ====================
============================= test session starts ==============================
platform linux -- Python 3.8.12, pytest-6.2.4, py-1.10.0, pluggy-0.13.1
rootdir: /dfs6/pub/lilyw7/pydev/psiresp, configfile: pyproject.toml
plugins: qcfractal-0.15.6, requests-mock-1.9.3
collected 3 items

test_orientation.py FFF                                                  [100%]

=================================== FAILURES ===================================
_ test_compute_esp[/dfs6/pub/lilyw7/pydev/psiresp/psiresp/tests/data/molecules/dmso_opt_c1.xyz-/dfs6/pub/lilyw7/pydev/psiresp/psiresp/tests/data/dmso_opt_c1.esp] _

coord_file = '/dfs6/pub/lilyw7/pydev/psiresp/psiresp/tests/data/molecules/dmso_opt_c1.xyz'
esp_file = '/dfs6/pub/lilyw7/pydev/psiresp/psiresp/tests/data/dmso_opt_c1.esp'
fractal_client = FractalClient(server_name='QCFractal Server', address='https://hpc3-l18-05:7777/', username='None')

    @pytest.mark.parametrize("coord_file, esp_file", [
        (DMSO, DMSO_ESP),
        (DMSO_O1, DMSO_O1_ESP),
        (DMSO_O2, DMSO_O2_ESP),
    ])
    def test_compute_esp(coord_file, esp_file, fractal_client):
        # setup
        qcmol = qcel.models.Molecule.from_file(coord_file)
        ref = load_gamess_esp(esp_file)
        ref_grid = ref[:, 1:]
        ref_esp = ref[:, 0]
>       orientation = Orientation(qcmol=qcmol, grid=ref_grid)
E       NameError: name 'Orientation' is not defined

test_orientation.py:31: NameError
------------------------------ Captured log setup ------------------------------
INFO     SQLAlcehmySocket:sqlalchemy_socket.py:200 SQLAlchemy attempt to connect to postgresql+psycopg2://localhost:34551/test_psiresp.
INFO     SQLAlcehmySocket:sqlalchemy_socket.py:209 Connected SQLAlchemy to DB dialect postgresql with driver psycopg2
INFO     SQLAlcehmySocket:sqlalchemy_socket.py:217 DB versions: {'created_on': datetime.datetime(2021, 10, 25, 1, 57, 21, 427302), 'elemental_version': 'v0.22.0', 'fractal_version': 'v0.15.6', 'engine_version': 'v0.19.0'}
INFO     tornado.application:server.py:315 FractalServer:
INFO     tornado.application:server.py:316     Name:          QCFractal Snowflake Instance
INFO     tornado.application:server.py:317     Version:       v0.15.6
INFO     tornado.application:server.py:318     Address:       http://localhost:59583/
INFO     tornado.application:server.py:319     Database URI:  postgresql://localhost:34551/
INFO     tornado.application:server.py:320     Database Name: test_psiresp
INFO     tornado.application:server.py:321     Query Limit:   1000000

INFO     tornado.application:server.py:637 Waiting on queue_manager to build.
INFO     tornado.application:server.py:414 FractalServer successfully started.

INFO     tornado.application:web_handlers.py:146 GET: Information
INFO     tornado.access:web.py:2239 200 GET /information (::1) 6.69ms
------------------------------ Captured log call -------------------------------
INFO     tornado.application:managers.py:226 QueueManager:
INFO     tornado.application:managers.py:227     Version:         v0.15.6

INFO     tornado.application:managers.py:235     Queue Adapter:
INFO     tornado.application:managers.py:236         <ExecutorAdapter client=<ProcessPoolExecutor max_workers=1>>

INFO     tornado.application:handlers.py:383 QueueManager: New active manager FractalServer-hpc3-l18-05-aac3eae5-ea24-44b0-ac47-0c3c0749fe2f detected.
INFO     tornado.access:web.py:2239 200 PUT /queue_manager (::1) 17.46ms
INFO     tornado.application:managers.py:347 QueueManager successfully started.

INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:332 QueueManager: Served 0 tasks.
INFO     tornado.application:managers.py:697 Acquired 0 new tasks.
INFO     tornado.access:web.py:2239 200 GET /queue_manager (::1) 30.04ms
INFO     tornado.access:web.py:2239 200 PUT /queue_manager (::1) 17.39ms
_ test_compute_esp[/dfs6/pub/lilyw7/pydev/psiresp/psiresp/tests/data/molecules/dmso_opt_c1_o1.xyz-/dfs6/pub/lilyw7/pydev/psiresp/psiresp/tests/data/dmso_opt_c1_o1.esp] _

coord_file = '/dfs6/pub/lilyw7/pydev/psiresp/psiresp/tests/data/molecules/dmso_opt_c1_o1.xyz'
esp_file = '/dfs6/pub/lilyw7/pydev/psiresp/psiresp/tests/data/dmso_opt_c1_o1.esp'
fractal_client = FractalClient(server_name='QCFractal Server', address='https://hpc3-l18-05:7777/', username='None')

    @pytest.mark.parametrize("coord_file, esp_file", [
        (DMSO, DMSO_ESP),
        (DMSO_O1, DMSO_O1_ESP),
        (DMSO_O2, DMSO_O2_ESP),
    ])
    def test_compute_esp(coord_file, esp_file, fractal_client):
        # setup
        qcmol = qcel.models.Molecule.from_file(coord_file)
        ref = load_gamess_esp(esp_file)
        ref_grid = ref[:, 1:]
        ref_esp = ref[:, 0]
>       orientation = Orientation(qcmol=qcmol, grid=ref_grid)
E       NameError: name 'Orientation' is not defined

test_orientation.py:31: NameError
_ test_compute_esp[/dfs6/pub/lilyw7/pydev/psiresp/psiresp/tests/data/molecules/dmso_opt_c1_o2.xyz-/dfs6/pub/lilyw7/pydev/psiresp/psiresp/tests/data/dmso_opt_c1_o2.esp] _

coord_file = '/dfs6/pub/lilyw7/pydev/psiresp/psiresp/tests/data/molecules/dmso_opt_c1_o2.xyz'
esp_file = '/dfs6/pub/lilyw7/pydev/psiresp/psiresp/tests/data/dmso_opt_c1_o2.esp'
fractal_client = FractalClient(server_name='QCFractal Server', address='https://hpc3-l18-05:7777/', username='None')

    @pytest.mark.parametrize("coord_file, esp_file", [
        (DMSO, DMSO_ESP),
        (DMSO_O1, DMSO_O1_ESP),
        (DMSO_O2, DMSO_O2_ESP),
    ])
    def test_compute_esp(coord_file, esp_file, fractal_client):
        # setup
        qcmol = qcel.models.Molecule.from_file(coord_file)
        ref = load_gamess_esp(esp_file)
        ref_grid = ref[:, 1:]
        ref_esp = ref[:, 0]
>       orientation = Orientation(qcmol=qcmol, grid=ref_grid)
E       NameError: name 'Orientation' is not defined

test_orientation.py:31: NameError
---------------------------- Captured log teardown -----------------------------
INFO     tornado.application:managers.py:358 QueueManager received shutdown signal: Not provided.

INFO     tornado.application:managers.py:679 Task statistics unavailable until first tasks return
INFO     tornado.application:handlers.py:389 QueueManager: Shutdown of manager FractalServer-hpc3-l18-05-aac3eae5-ea24-44b0-ac47-0c3c0749fe2f detected, recycling 0 incomplete tasks.
INFO     tornado.application:managers.py:431 Shutdown was successful, 0 tasks returned to master queue.
INFO     tornado.application:managers.py:375 QueueManager stopping gracefully.

INFO     tornado.access:web.py:2239 200 PUT /queue_manager (::1) 27.46ms
INFO     tornado.application:server.py:456 FractalServer stopping gracefully. Stopped IOLoop.
=============================== warnings summary ===============================
../../../../../../../data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/past/builtins/misc.py:45
  /data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/past/builtins/misc.py:45: DeprecationWarning: the imp module is deprecated in favour of importlib; see the module's documentation for alternative uses
    from imp import reload

-- Docs: https://docs.pytest.org/en/stable/warnings.html
=========================== short test summary info ============================
FAILED test_orientation.py::test_compute_esp[/dfs6/pub/lilyw7/pydev/psiresp/psiresp/tests/data/molecules/dmso_opt_c1.xyz-/dfs6/pub/lilyw7/pydev/psiresp/psiresp/tests/data/dmso_opt_c1.esp]
FAILED test_orientation.py::test_compute_esp[/dfs6/pub/lilyw7/pydev/psiresp/psiresp/tests/data/molecules/dmso_opt_c1_o1.xyz-/dfs6/pub/lilyw7/pydev/psiresp/psiresp/tests/data/dmso_opt_c1_o1.esp]
FAILED test_orientation.py::test_compute_esp[/dfs6/pub/lilyw7/pydev/psiresp/psiresp/tests/data/molecules/dmso_opt_c1_o2.xyz-/dfs6/pub/lilyw7/pydev/psiresp/psiresp/tests/data/dmso_opt_c1_o2.esp]
========================= 3 failed, 1 warning in 7.86s =========================
============================= test session starts ==============================
platform linux -- Python 3.8.12, pytest-6.2.4, py-1.10.0, pluggy-0.13.1
rootdir: /dfs6/pub/lilyw7/pydev/psiresp, configfile: pyproject.toml
plugins: qcfractal-0.15.6, requests-mock-1.9.3
collected 1 item

test_rdutils.py F                                                        [100%]

=================================== FAILURES ===================================
_________________________ test_rdmol_from_qcelemental __________________________

dmso_qcmol = Molecule(name='C2H6OS', formula='C2H6OS', hash='d8fbedf')

    def test_rdmol_from_qcelemental(dmso_qcmol):
>       rdmol = rdmol_from_qcelemental(dmso_qcmol)
E       NameError: name 'rdmol_from_qcelemental' is not defined

test_rdutils.py:7: NameError
=============================== warnings summary ===============================
../../../../../../../data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/past/builtins/misc.py:45
  /data/homezvol0/lilyw7/miniconda3/envs/psiresp-3.8/lib/python3.8/site-packages/past/builtins/misc.py:45: DeprecationWarning: the imp module is deprecated in favour of importlib; see the module's documentation for alternative uses
    from imp import reload

-- Docs: https://docs.pytest.org/en/stable/warnings.html
=========================== short test summary info ============================
FAILED test_rdutils.py::test_rdmol_from_qcelemental - NameError: name 'rdmol_...
========================= 1 failed, 1 warning in 0.25s =========================
